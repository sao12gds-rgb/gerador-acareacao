<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerador de Acareação - Azul Cargo</title>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
    .container { max-width: 900px; margin: 0 auto; }

    /* ====== FORM ====== */
    .form-card{
      background:#fff; border-radius:14px; padding:22px;
      box-shadow:0 2px 12px rgba(0,0,0,.08);
    }
    .brand{
      text-align:center; padding:10px 0 18px;
    }
    .brand img{
      max-width: 260px; width: 70%; height:auto; display:block; margin:0 auto 10px;
    }
    .brand h1{
      color:#0b5dbb; font-size:30px; line-height:1.15; margin-top:6px;
      font-weight:800;
    }

    .field{ margin: 14px 0; }
    label{ display:block; font-weight:800; color:#222; margin: 0 0 8px; }
    .req{ color:#d93025; font-weight:900; margin-left:3px; }

    input, select, textarea{
      width:100%; padding:14px 12px; border:1px solid #d7d7d7;
      border-radius:10px; font-size:16px; outline:none; background:#fff;
    }
    textarea{ min-height: 120px; resize: vertical; }
    input:focus, select:focus, textarea:focus{
      border-color:#0b5dbb; box-shadow:0 0 0 3px rgba(11,93,187,.12);
    }

    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    @media(max-width: 720px){ .grid2{ grid-template-columns:1fr; } }

    .uploadBox{
      border:2px dashed #0b5dbb; border-radius:12px; padding:16px; background:#eef6ff;
    }
    .uploadBox .title{ font-weight:900; color:#0b5dbb; margin-bottom:10px; font-size:18px; }
    #fileInput{ display:none; }
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      width:100%; padding:14px 12px; border:none; border-radius:12px;
      font-weight:900; font-size:18px; cursor:pointer;
    }
    .btnPrimary{ background:#0b5dbb; color:#fff; }
    .btnPrimary:active{ transform: translateY(1px); }
    .btnGhost{
      background:#fff; border:2px solid #0b5dbb; color:#0b5dbb;
    }
    .btnRow{ display:grid; grid-template-columns:1fr; gap:12px; margin-top:14px; }
    .btnRow2{ display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px; }
    @media(max-width:720px){ .btnRow2{ grid-template-columns:1fr; } }

    .hint{
      margin-top:10px; padding:12px; border-radius:10px;
      background:#e9f2ff; color:#0a3d7a; font-size:14px; border-left:5px solid #0b5dbb;
    }

    .waArea{ margin-top:14px; }
    .waArea textarea{ min-height: 150px; }

    /* ====== DOC PAGES (PRINT) ====== */
    .pages{ display:none; margin-top:18px; }
    .pages.visible{ display:block; }

    .page{
      width: 210mm;
      min-height: 297mm;
      background:#fff;
      margin: 0 auto 14px;
      padding: 12mm 12mm;
      border: 1px solid #bbb;
    }

    .docHeader{
      text-align:center;
      margin-bottom: 10px;
    }
    .docHeader img{
      max-width: 160px;
      height:auto;
      display:block;
      margin: 0 auto 6px;
    }
    .docTitle{
      font-weight:900;
      letter-spacing:.5px;
      border-bottom:1px solid #000;
      padding-bottom:6px;
      margin: 8px 0 10px;
      text-transform:uppercase;
      font-size:16px;
    }

    .metaRow{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
      font-size:12px;
      margin-bottom: 10px;
    }
    .metaRow div{ border-bottom:1px solid #d9d9d9; padding-bottom:6px; }
    .metaRow strong{ font-weight:900; }

    .etiquetaWrap{
      width: 290px;
      height: 360px;
      margin: 10px auto 14px;
      border:2px solid #000;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
    }
    .etiquetaWrap img{ max-width:100%; max-height:100%; display:none; }
    .etiquetaPh{ color:#444; font-weight:800; }

    .diretrizes{
      border:1px solid #b8b8b8;
      padding:10px;
      font-size:12px;
      line-height:1.4;
    }
    .diretrizes strong{ font-weight:900; }

    .box{
      border:2px solid #000;
      padding: 10px;
      font-size:12px;
      line-height:1.35;
    }
    .linha{
      display:inline-block;
      border-bottom:1px solid #000;
      height: 14px;
      vertical-align:baseline;
      margin: 0 4px;
    }
    .wNome{ width: 56%; }
    .wDoc{ width: 20%; }
    .wPar{ width: 28%; }

    .perguntas{
      border:1px solid #000;
      padding:8px;
      margin-top: 8px;
      font-size:12px;
    }
    .gridPerg{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:8px 18px;
      margin-top:6px;
    }
    .q{
      display:flex;
      justify-content:space-between;
      gap:10px;
      align-items:flex-start;
      border:1px solid #d0d0d0;
      padding:8px;
      background:#fafafa;
      min-height:46px;
    }
    .q span{ font-weight:900; white-space:nowrap; }
    .q label{ font-weight:700; margin:0; }

    .linhasArea{
      margin-top: 10px;
      font-size:12px;
    }
    .linhasArea .ttl{ font-weight:900; margin-bottom:4px; }
    .linhas{
      border:1px solid #000;
      padding: 8px;
      min-height: 90px;
    }
    .r{
      border-bottom:1px solid #000;
      height: 16px;
      margin-bottom: 6px;
    }

    .rodape{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:16px;
      margin-top: 10px;
      font-size:12px;
    }
    .campoLinha{
      display:flex; align-items:flex-end; gap:8px;
    }
    .campoLinha strong{ min-width:42px; }
    .campoLinha .lineFull{
      flex:1; border-bottom:1px solid #000; height: 14px;
    }

    .assin{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:30px;
      margin-top: 16px;
      font-size:12px;
      text-align:center;
    }
    .assin .topLine{ border-top:1px solid #000; padding-top:6px; }

    .pageBreak{ page-break-before: always; }

    /* ====== PRINT RULES ====== */
    @page { size: A4; margin: 10mm; }

    @media print{
      body{ background:#fff; padding:0; }
      .form-card{ display:none !important; }
      .pages{ display:block !important; }
      .page{ border:none; margin:0; width:auto; min-height:auto; padding:0; }
      .docHeader img{ max-width: 140px; }
      .pageBreak{ page-break-before: always; }
      /* garante 2 páginas */
      #page1{ page-break-after: always; }
      #page2{ page-break-after: auto; }
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- ====== FORM ====== -->
    <div class="form-card">
      <div class="brand">
        <!-- IMPORTANTE: arquivo no repo deve ser exatamente "logo-azulcargo.png" -->
        <img src="logo-azulcargo.png" alt="Azul Cargo Express"
             onerror="this.style.display='none'; alert('Logo não carregou. Confirme se o arquivo está na raiz e o nome é: logo-azulcargo.png');">
        <h1>Gerador de Acareação Azul<br/>Cargo</h1>
      </div>

      <div class="field">
        <label>Entregador <span class="req">*</span></label>
        <input id="entregador" placeholder="Ex: EVERTON FRANCISCO" required>
      </div>

      <div class="field">
        <label>CTE/CTR <span class="req">*</span></label>
        <input id="cte" placeholder="Ex: 29031903" required>
      </div>

      <div class="field">
        <label>Motivo da Acareação <span class="req">*</span></label>
        <select id="motivo" required>
          <option value="" selected disabled>Selecione...</option>
          <option>CLIENTE DESCONHECE O RECEBIMENTO</option>
          <option>ENDEREÇO NÃO LOCALIZADO</option>
          <option>CLIENTE RECUSOU</option>
          <option>HORÁRIO COMERCIAL</option>
          <option>OUTRO</option>
        </select>
      </div>

      <div class="grid2">
        <div class="field">
          <label>Data da Entrega <span class="req">*</span></label>
          <input id="dataEntrega" type="date" required>
        </div>
        <div class="field">
          <label>Data da Solicitação <span class="req">*</span></label>
          <input id="dataSolic" type="date" required>
        </div>
      </div>

      <div class="field">
        <label>Data Limite <span class="req">*</span></label>
        <input id="dataLimite" type="date" required>
      </div>

      <div class="grid2">
        <div class="field">
          <label>WhatsApp 1 (somente números)</label>
          <input id="wa1" inputmode="numeric" placeholder="Ex: 5511999999999">
        </div>
        <div class="field">
          <label>WhatsApp 2 (somente números)</label>
          <input id="wa2" inputmode="numeric" placeholder="Ex: 5511988888888">
        </div>
      </div>

      <div class="field">
        <label>Diretrizes (Página 1) — automático</label>
        <textarea id="diretrizes" readonly></textarea>
        <div class="hint">Esse texto sai no PDF/Impressão (Página 1).</div>
      </div>

      <div class="field uploadBox">
        <div class="title">Etiqueta (imagem) <span class="req">*</span> — sai na Página 1 e IMPRIME</div>
        <input type="file" id="fileInput" accept="image/*">
        <button class="btn btnGhost" type="button" onclick="document.getElementById('fileInput').click()">Selecionar etiqueta</button>
        <div class="hint" id="etqHint">Nenhuma etiqueta selecionada ainda.</div>
      </div>

      <div class="waArea field">
        <label>Mensagem WhatsApp (gerada automaticamente)</label>
        <textarea id="waMsg" placeholder="Clique em “Gerar Documento” para preencher automaticamente..." readonly></textarea>

        <div class="btnRow2">
          <button class="btn btnGhost" type="button" onclick="copiarMensagem()">Copiar Mensagem</button>
          <button class="btn btnGhost" type="button" onclick="abrirWhats()">Abrir WhatsApp Web</button>
        </div>
        <div class="btnRow2">
          <button class="btn btnGhost" type="button" onclick="abrirWhats(1)">Abrir WhatsApp 1</button>
          <button class="btn btnGhost" type="button" onclick="abrirWhats(2)">Abrir WhatsApp 2</button>
        </div>

        <div class="hint">
          Observação: o navegador NÃO consegue anexar o PDF automaticamente no WhatsApp (isso é limitação do WhatsApp Web).
          Ele abre a conversa com a mensagem pronta — aí você anexa o PDF/arquivo manualmente.
        </div>
      </div>

      <div class="btnRow">
        <button class="btn btnPrimary" type="button" onclick="gerarDocumento()">Gerar Documento</button>
      </div>
      <div class="btnRow2">
        <button class="btn btnPrimary" id="btnPdf" type="button" style="display:none" onclick="baixarPDF()">
          ✅ Baixar PDF (abre impressão / salvar como PDF)
        </button>
        <button class="btn btnGhost" id="btnVerDoc" type="button" style="display:none" onclick="scrollDocs()">
          Ver Documento Gerado
        </button>
      </div>
    </div>

    <!-- ====== DOCS (PRINT) ====== -->
    <div class="pages" id="pages">
      <!-- PAGE 1 -->
      <div class="page" id="page1">
        <div class="docHeader">
          <img src="logo-azulcargo.png" alt="Azul Cargo Express">
          <div class="docTitle">ACAREAÇÃO</div>
        </div>

        <div class="metaRow">
          <div><strong>Entregador:</strong> <span id="p1Entregador"></span></div>
          <div><strong>CTE:</strong> <span id="p1CTE"></span></div>
          <div><strong>Data Entrega:</strong> <span id="p1DE"></span></div>
          <div><strong>Data Solicitação:</strong> <span id="p1DS"></span></div>
          <div><strong>Data Limite:</strong> <span id="p1DL"></span></div>
          <div><strong>Motivo:</strong> <span id="p1Motivo"></span></div>
        </div>

        <div class="etiquetaWrap">
          <img id="etqImg" alt="Etiqueta">
          <div class="etiquetaPh" id="etqPh">ETIQUETA</div>
        </div>

        <div class="diretrizes" id="p1Diretrizes"></div>
      </div>

      <!-- PAGE 2 -->
      <div class="page pageBreak" id="page2">
        <div class="docHeader">
          <img src="logo-azulcargo.png" alt="Azul Cargo Express">
          <div class="docTitle">ACAREAÇÃO</div>
        </div>

        <div class="box">
          <div style="text-align:center; font-weight:900; margin-bottom:6px;">ACAREAÇÃO</div>

          <div>
            Eu,<span class="linha wNome"></span>
            portador(a) do documento RG/CPF nº<span class="linha wDoc"></span>,
            grau de parentesco com destinatário<span class="linha wPar"></span>,
            declaro informações referente ao CTE <strong><span id="p2CTE"></span></strong>
            (Campos de preenchimento obrigatório):
          </div>

          <div class="perguntas">
            <div class="gridPerg">
              <div class="q">
                <label>Recebi a carga mencionada</label>
                <span>(__) SIM &nbsp;&nbsp; (__) NÃO</span>
              </div>
              <div class="q">
                <label>Produtos internos estavam intactos</label>
                <span>(__) SIM &nbsp;&nbsp; (__) NÃO</span>
              </div>

              <div class="q">
                <label>Recebi a carga em perfeitas condições</label>
                <span>(__) SIM &nbsp;&nbsp; (__) NÃO</span>
              </div>
              <div class="q">
                <label>Estavam faltando itens do pedido dentro da caixa</label>
                <span>(__) SIM &nbsp;&nbsp; (__) NÃO</span>
              </div>

              <div class="q">
                <label>Recebi a embalagem danificada</label>
                <span>(__) SIM &nbsp;&nbsp; (__) NÃO</span>
              </div>
              <div class="q" style="background:#fff; border:1px solid transparent;">
                <label style="opacity:.65"> </label>
                <span style="opacity:.65">(Campos de preenchimento obrigatório)</span>
              </div>
            </div>
          </div>
        </div>

        <div class="linhasArea">
          <div class="ttl">Relato destinatário (Campo de preenchimento obrigatório):</div>
          <div class="linhas">
            <div class="r"></div><div class="r"></div><div class="r"></div><div class="r"></div>
          </div>
        </div>

        <div class="linhasArea">
          <div class="ttl">Observações Entregador (Campo de preenchimento obrigatório):</div>
          <div class="linhas">
            <div class="r"></div><div class="r"></div><div class="r"></div>
          </div>
        </div>

        <div class="rodape">
          <div class="campoLinha"><strong>Local:</strong><div class="lineFull"></div></div>
          <div class="campoLinha"><strong>Data:</strong><div class="lineFull"></div></div>
        </div>

        <div class="assin">
          <div class="topLine">Nome/Assinatura do cliente</div>
          <div class="topLine">Nome/Assinatura do entregador<br><strong><span id="p2Entregador"></span></strong></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Diretrizes fixas automáticas =====
    const TEXTO_DIRETRIZES =
`INFORMAÇÕES IMPORTANTES:
- Quando o motivo desta acareação for “CLIENTE DESCONHECE O RECEBIMENTO”, somente o entregador que realizou a entrega poderá realizar a acareação.
- Na condição de ausência de pessoas no local, OBRIGATÓRIA foto do local repassado no grupo de WhatsApp.
- No caso de acareação realizada onde o destinatário estiver ausente, e ainda assim estiver alguém no local (no caso de portaria por exemplo), ALÉM DA FOTO DO LOCAL repassada pelo grupo de WhatsApp, solicitar o preenchimento do formulário, indicando no campo “Grau de Parentesco = PORTARIA”.`;

    document.getElementById('diretrizes').value = TEXTO_DIRETRIZES;

    // ===== Etiqueta (imagem) =====
    let etiquetaDataUrl = "";
    const fileInput = document.getElementById('fileInput');
    fileInput.addEventListener('change', (e) => {
      const f = e.target.files && e.target.files[0];
      if(!f) return;

      if(!f.type.startsWith("image/")){
        alert("Selecione uma IMAGEM (PNG/JPG). PDF não imprime como imagem aqui.");
        fileInput.value = "";
        return;
      }

      const reader = new FileReader();
      reader.onload = (ev) => {
        etiquetaDataUrl = ev.target.result;
        document.getElementById('etqHint').textContent = "Etiqueta selecionada ✓";
      };
      reader.readAsDataURL(f);
    });

    // ===== Helpers =====
    function soNumeros(v){ return (v || "").replace(/\D/g,''); }
    function formatarDataISO(iso){
      if(!iso) return "";
      const d = new Date(iso + "T00:00:00");
      return d.toLocaleDateString("pt-BR");
    }

    function gerarMensagemWhats({cte, motivo, entregador, de, ds, dl}){
      return `Olá! Tudo bem?\n\n` +
        `Segue em anexo o documento de ACAREAÇÃO.\n\n` +
        `• CTE: ${cte}\n` +
        `• Motivo: ${motivo}\n` +
        `• Entregador: ${entregador}\n` +
        `• Data Entrega: ${de}\n` +
        `• Data Solicitação: ${ds}\n` +
        `• Data Limite: ${dl}\n\n` +
        `Por gentileza, confirmar o recebimento e nos retornar após o preenchimento.`;
    }

    // ===== Gerar documento =====
    function gerarDocumento(){
      const entregadorRaw = document.getElementById('entregador').value.trim();
      const cteRaw = document.getElementById('cte').value.trim();
      const motivo = (document.getElementById('motivo').value || "").trim();

      const dataEntrega = document.getElementById('dataEntrega').value;
      const dataSolic = document.getElementById('dataSolic').value;
      const dataLimite = document.getElementById('dataLimite').value;

      if(!entregadorRaw || !cteRaw || !motivo || !dataEntrega || !dataSolic || !dataLimite){
        alert("Preencha todos os campos obrigatórios (*).");
        return;
      }

      if(!etiquetaDataUrl){
        // você pediu etiqueta para imprimir na página 1
        alert("Selecione a etiqueta (imagem) para sair na Página 1.");
        return;
      }

      const entregador = entregadorRaw.toUpperCase();
      const cte = cteRaw;

      const de = formatarDataISO(dataEntrega);
      const ds = formatarDataISO(dataSolic);
      const dl = formatarDataISO(dataLimite);

      // Page 1 fill
      document.getElementById('p1Entregador').textContent = entregador;
      document.getElementById('p1CTE').textContent = cte;
      document.getElementById('p1DE').textContent = de;
      document.getElementById('p1DS').textContent = ds;
      document.getElementById('p1DL').textContent = dl;
      document.getElementById('p1Motivo').textContent = motivo;

      // Diretrizes
      document.getElementById('p1Diretrizes').innerHTML =
        `<strong>INFORMAÇÕES IMPORTANTES:</strong><br>` +
        `- Quando o motivo desta acareação for “CLIENTE DESCONHECE O RECEBIMENTO”, somente o entregador que realizou a entrega poderá realizar a acareação.<br>` +
        `- Na condição de ausência de pessoas no local, OBRIGATÓRIA foto do local repassado no grupo de WhatsApp.<br>` +
        `- No caso de acareação realizada onde o destinatário estiver ausente, e ainda assim estiver alguém no local (no caso de portaria por exemplo), ALÉM DA FOTO DO LOCAL repassada pelo grupo de WhatsApp, solicitar o preenchimento do formulário, indicando no campo “Grau de Parentesco = PORTARIA”.`;

      // Etiqueta image in print
      const img = document.getElementById('etqImg');
      img.src = etiquetaDataUrl;
      img.style.display = "block";
      document.getElementById('etqPh').style.display = "none";

      // Page 2 fill
      document.getElementById('p2CTE').textContent = cte;
      document.getElementById('p2Entregador').textContent = entregador;

      // WhatsApp message auto
      const msg = gerarMensagemWhats({cte, motivo, entregador, de, ds, dl});
      document.getElementById('waMsg').value = msg;

      // show docs + buttons
      const pages = document.getElementById('pages');
      pages.classList.add('visible');
      document.getElementById('btnPdf').style.display = "inline-flex";
      document.getElementById('btnVerDoc').style.display = "inline-flex";

      // scroll
      setTimeout(scrollDocs, 100);
    }

    function scrollDocs(){
      document.getElementById('pages').scrollIntoView({behavior:"smooth", block:"start"});
    }

    // ===== PDF/Print =====
    function baixarPDF(){
      // Isso abre a impressão. No print, escolha "Salvar como PDF".
      window.print();
    }

    // ===== WhatsApp actions =====
    function copiarMensagem(){
      const t = document.getElementById('waMsg').value.trim();
      if(!t){
        alert("Gere o documento primeiro para criar a mensagem.");
        return;
      }
      navigator.clipboard.writeText(t).then(() => {
        alert("Mensagem copiada!");
      }).catch(() => {
        // fallback
        const area = document.getElementById('waMsg');
        area.removeAttribute("readonly");
        area.select();
        document.execCommand("copy");
        area.setAttribute("readonly","readonly");
        alert("Mensagem copiada!");
      });
    }

    function abrirWhats(tipo){
      const msg = document.getElementById('waMsg').value.trim();
      if(!msg){
        alert("Gere o documento primeiro para criar a mensagem.");
        return;
      }

      const wa1 = soNumeros(document.getElementById('wa1').value);
      const wa2 = soNumeros(document.getElementById('wa2').value);

      let phone = "";
      if(tipo === 1) phone = wa1;
      else if(tipo === 2) phone = wa2;
      else phone = wa1 || wa2; // padrão: primeiro que tiver

      const textEnc = encodeURIComponent(msg);

      // Se tiver telefone, abre conversa direta; se não, abre whatsapp web com texto (pode colar manualmente)
      let url = "";
      if(phone){
        url = `https://wa.me/${phone}?text=${textEnc}`;
      }else{
        url = `https://web.whatsapp.com/`;
      }

      window.open(url, "_blank");
    }
  </script>
</body>
</html>
