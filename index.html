<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Gerador de Acarea√ß√£o - Azul Cargo</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
    }

    .container { max-width: 900px; margin: 0 auto; }

    .form-container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }

    .form-container h1 {
      color: #0066cc;
      font-size: 24px;
      margin-bottom: 20px;
      text-align: center;
    }

    .logo-main {
      width: 240px;
      height: auto;
      display: block;
      margin: 0 auto 12px auto;
    }

    .form-group { margin-bottom: 20px; }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
      font-size: 14px;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      font-family: Arial, sans-serif;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #0066cc;
      box-shadow: 0 0 5px rgba(0,102,204,0.3);
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    button {
      flex: 1;
      min-width: 180px;
      padding: 14px;
      font-size: 16px;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-generate { background-color: #0066cc; color: white; }
    .btn-generate:hover { background-color: #0052a3; }

    .btn-pdf { background-color: #28a745; color: white; display: none; }
    .btn-pdf.visible { display: inline-flex; justify-content:center; }
    .btn-pdf:hover { background-color: #218838; }

    .btn-clear { background-color: #6c757d; color: white; }
    .btn-clear:hover { background-color: #5a6268; }

    .upload-section {
      margin-top: 20px;
      padding: 15px;
      background-color: #e7f3ff;
      border: 2px dashed #0066cc;
      border-radius: 8px;
    }

    .upload-section .small {
      font-size: 12px;
      color: #333;
      margin-top: 6px;
      line-height: 1.4;
    }

    /* input file: mant√©m acess√≠vel e clic√°vel no mobile */
    #fileInput {
      position: absolute;
      left: -9999px;
      width: 1px;
      height: 1px;
      opacity: 0;
    }

    .upload-btn {
      background-color: #0066cc;
      color: white;
      padding: 12px 18px;
      border-radius: 8px;
      cursor: pointer;
      display: inline-block;
      font-size: 14px;
      margin-top: 10px;
      user-select: none;
      font-weight: bold;
    }
    .upload-btn:hover { background-color: #0052a3; }

    .image-preview { margin-top: 15px; display: none; }
    .image-preview img { max-width: 300px; border: 1px solid #ddd; border-radius: 4px; }

    .pages-container { display: none; }
    .pages-container.visible { display: block; }

    .doc-page {
      background: white;
      padding: 15mm;
      margin: 0;
      width: 210mm;
      min-height: 297mm;
      border: 1px solid #999;
      font-family: Arial, sans-serif;
      font-size: 13px;
      line-height: 1.35;
    }

    .logo-header { width: 100%; text-align: center; margin-bottom: 6px; }
    .logo-header img { max-width: 150px; height: auto; }

    .doc-title {
      text-align:center;
      font-weight:bold;
      font-size:16px;
      border-bottom:1px solid #000;
      padding-bottom:6px;
      margin-bottom:10px;
      letter-spacing: 0.5px;
    }

    .doc-meta {
      font-size: 12px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 20px;
      border-bottom: 1px solid #ddd;
      padding-bottom: 8px;
      margin-bottom: 10px;
    }

    .etiqueta-space {
      width: 280px;
      height: 350px;
      border: 2px solid #000;
      margin: 12px auto 10px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: #fff;
    }
    .etiqueta-space img { max-width: 100%; max-height: 100%; display:none; }
    .etiqueta-space .placeholder { color:#777; font-weight:bold; }

    .doc-important {
      margin-top: 10px;
      border: 1px solid #000;
      padding: 10px;
      font-size: 12px;
      line-height: 1.35;
    }
    .doc-important strong { display:block; margin-bottom: 6px; }

    .declaration-box {
      border: 2px solid #000;
      padding: 10px;
      font-size: 12px;
    }

    .inline-line {
      display: inline-block;
      border-bottom: 1px solid #000;
      min-width: 180px;
      height: 14px;
      vertical-align: bottom;
      margin: 0 4px;
    }
    .inline-line.wide { min-width: 260px; }
    .inline-line.long { min-width: 320px; }

    .check-area {
      border: 1px solid #000;
      margin-top: 10px;
      padding: 10px;
      font-size: 12px;
    }
    .check-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 20px;
    }
    .check-item { display:flex; justify-content:space-between; gap:10px; }
    .check-boxes { white-space: nowrap; }

    .lines-block {
      margin-top: 12px;
      font-size: 12px;
    }
    .lines-block .label { margin-bottom: 6px; font-weight:bold; }
    .line {
      border-bottom: 1px solid #000;
      height: 16px;
      margin-bottom: 6px;
    }

    .footer-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-top: 12px;
      font-size: 12px;
    }
    .footer-field {
      display:flex;
      gap: 8px;
      align-items: baseline;
    }
    .footer-blank {
      flex:1;
      border-bottom: 1px solid #000;
      height: 14px;
    }

    .signature {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:40px;
      margin-top: 24px;
      text-align:center;
      font-size: 12px;
    }
    .signature .sig-line {
      border-top: 1px solid #000;
      padding-top: 6px;
      min-height: 40px;
    }

    .page-break { page-break-before: always; }

    /* WhatsApp area */
    .wa-box {
      margin-top: 18px;
    }

    .wa-actions {
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }

    .btn-copy { background:#0b5ed7; color:#fff; }
    .btn-copy:hover { background:#0a58ca; }

    .btn-wa {
      background:#25D366;
      color:#fff;
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn-wa.enabled {
      opacity: 1;
      cursor: pointer;
    }
    .btn-wa.enabled:hover { filter: brightness(0.95); }

    .note {
      font-size: 12px;
      color: #333;
      margin-top: 6px;
      line-height: 1.35;
    }

    /* impress√£o */
    @media print {
      body { background: white; padding: 0; margin: 0; }
      .form-container { display: none !important; }
      .container { max-width: 100%; margin: 0; }
      .pages-container { display: block !important; }
      .doc-page {
        border: none;
        margin: 0;
        width: auto;
        min-height: auto;
      }
      .logo-header img { max-width: 140px; }
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- FORMUL√ÅRIO -->
    <div class="form-container">
      <!-- Logo (nome no repo: logo-azulcargo.png) -->
      <img class="logo-main" src="logo-azulcargo.png" alt="Azul Cargo Express"
           onerror="this.style.display='none'; alert('Logo n√£o carregou. Confirme que o arquivo est√° na RAIZ e o nome √©: logo-azulcargo.png');" />

      <h1>Gerador de Acarea√ß√£o Azul Cargo</h1>

      <form id="form">
        <div class="form-row">
          <div class="form-group">
            <label for="entregador">Entregador *</label>
            <input type="text" id="entregador" placeholder="Ex: EVERTON FRANCISCO" required />
          </div>

          <div class="form-group">
            <label for="cte">AWB/CTE *</label>
            <input type="text" id="cte" placeholder="Ex: 29031903" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="motivo">Motivo da Acarea√ß√£o *</label>
            <select id="motivo" required>
              <option value="">Selecione...</option>
              <option value="CLIENTE DESCONHECE O RECEBIMENTO">CLIENTE DESCONHECE O RECEBIMENTO</option>
              <option value="ENDERE√áO N√ÉO LOCALIZADO">ENDERE√áO N√ÉO LOCALIZADO</option>
              <option value="CLIENTE RECUSOU">CLIENTE RECUSOU</option>
              <option value="HOR√ÅRIO COMERCIAL">HOR√ÅRIO COMERCIAL</option>
              <option value="OUTRO">OUTRO</option>
            </select>
          </div>

          <div class="form-group">
            <label for="dataEntrega">Data da Entrega *</label>
            <input type="date" id="dataEntrega" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="dataSolicitacao">Data/Hora da Solicita√ß√£o *</label>
            <input type="datetime-local" id="dataSolicitacao" required />
          </div>

          <div class="form-group">
            <label for="dataLimite">Prazo de Entrega da Solicita√ß√£o *</label>
            <input type="date" id="dataLimite" required />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="wa1">WhatsApp 1 (somente n√∫meros)</label>
            <input type="tel" id="wa1" inputmode="numeric" placeholder="Ex: 5511999999999" />
          </div>

          <div class="form-group">
            <label for="wa2">WhatsApp 2 (somente n√∫meros)</label>
            <input type="tel" id="wa2" inputmode="numeric" placeholder="Ex: 5511988888888" />
          </div>
        </div>

        <div class="upload-section">
          <label><strong>Etiqueta (imagem)</strong> ‚Äî sai na P√°gina 1 e IMPRIME</label>
          <div class="small">Selecione a imagem da etiqueta (JPG/PNG). PDF como etiqueta n√£o d√° para embutir direto (navegador).</div>

          <input type="file" id="fileInput" accept="image/*" />

          <!-- bot√£o que realmente abre o seletor -->
          <div class="upload-btn" id="btnEtiqueta">Selecionar etiqueta</div>

          <div class="image-preview" id="imagePreview">
            <img id="previewImg" src="" alt="Etiqueta" />
          </div>
        </div>

        <div class="wa-box">
          <div class="form-group">
            <label for="waMsg">Mensagem WhatsApp (gerada automaticamente)</label>
            <textarea id="waMsg" rows="7" placeholder="Clique em ‚ÄúGerar Documento‚Äù para preencher automaticamente..." readonly></textarea>
          </div>

          <div class="wa-actions">
            <button type="button" class="btn-copy" id="btnCopy">Copiar Mensagem</button>
            <button type="button" class="btn-wa" id="btnWA">Abrir WhatsApp</button>
          </div>

          <div class="note">
            Observa√ß√£o: o navegador n√£o consegue anexar o PDF automaticamente no WhatsApp. Ele abre a conversa com a mensagem pronta; voc√™ clica no ‚Äúüìé‚Äù e anexa o PDF salvo.
          </div>
        </div>

        <div class="button-group">
          <button type="submit" class="btn-generate">Gerar Documento</button>
          <button type="button" class="btn-pdf" id="btnPDF">Baixar PDF</button>
          <button type="reset" class="btn-clear" id="btnClear">Limpar</button>
        </div>
      </form>
    </div>

    <!-- DOCUMENTOS GERADOS -->
    <div class="pages-container" id="pagesContainer">

      <!-- P√ÅGINA 1 (ETIQUETA + DIRETRIZES) -->
      <div class="doc-page" id="page1">
        <div class="logo-header">
          <img src="logo-azulcargo.png" alt="Azul Cargo Express"
               onerror="this.style.display='none';" />
        </div>

        <div class="doc-title">ACAREA√á√ÉO</div>

        <div class="doc-meta">
          <div><strong>ENTREGADOR:</strong> <span id="doc-entregador-p1"></span></div>
          <div><strong>AWB/CTE:</strong> <span id="doc-cte-p1"></span></div>
          <div><strong>Data da Entrega:</strong> <span id="doc-dataEntrega-p1"></span></div>
          <div><strong>Data/Hora da Solicita√ß√£o:</strong> <span id="doc-dataSolicitacao-p1"></span></div>
          <div><strong>Prazo de Entrega da Solicita√ß√£o:</strong> <span id="doc-dataLimite-p1"></span></div>
          <div><strong>Motivo:</strong> <span id="doc-motivo-p1"></span></div>
        </div>

        <div class="etiqueta-space">
          <img id="etiquetaImgDoc" alt="Etiqueta" />
          <div class="placeholder" id="etiquetaPlaceholder">ETIQUETA</div>
        </div>

        <div class="doc-important" id="diretrizesBox">
          <strong>INFORMA√á√ïES IMPORTANTES:</strong>
          <div>- Quando o motivo desta acarea√ß√£o for ‚ÄúCLIENTE DESCONHECE O RECEBIMENTO‚Äù, somente o entregador que realizou a entrega poder√° realizar a acarea√ß√£o.</div>
          <div style="margin-top:6px;">- Na condi√ß√£o de aus√™ncia de pessoas no local, OBRIGAT√ìRIA foto do local repassado no grupo de WhatsApp.</div>
          <div style="margin-top:6px;">- No caso de acarea√ß√£o realizada onde o destinat√°rio estiver ausente, e ainda assim estiver algu√©m no local (no caso de portaria por exemplo), ALEM DA FOTO DO LOCAL repassada pelo grupo de WhatsApp, solicitar o preenchimento do formul√°rio, indicando no campo ‚ÄúGrau de Parentesco = PORTARIA‚Äù.</div>
        </div>
      </div>

      <!-- P√ÅGINA 2 (FORMUL√ÅRIO COM PERGUNTAS PARA TICKAR) -->
      <div class="doc-page page-break" id="page2">
        <div class="logo-header">
          <img src="logo-azulcargo.png" alt="Azul Cargo Express"
               onerror="this.style.display='none';" />
        </div>

        <div class="doc-title">ACAREA√á√ÉO</div>

        <div style="font-size:12px; margin-bottom:8px;">
          Eu, <span class="inline-line long"></span>
          portador(a) do documento RG/CPF n¬∫ <span class="inline-line"></span>,
          grau de parentesco com destinat√°rio <span class="inline-line wide"></span>,
          declaro informa√ß√µes referente ao CTE <strong><span id="doc-cte2"></span></strong> (Campos de preenchimento obrigat√≥rio):
        </div>

        <div class="check-area">
          <div class="check-grid">
            <div class="check-item">
              <div>Recebi a carga mencionada</div>
              <div class="check-boxes">( ) SIM&nbsp;&nbsp;&nbsp;( ) N√ÉO</div>
            </div>
            <div class="check-item">
              <div>Produtos internos estavam intactos</div>
              <div class="check-boxes">( ) SIM&nbsp;&nbsp;&nbsp;( ) N√ÉO</div>
            </div>

            <div class="check-item">
              <div>Recebi a carga em perfeitas condi√ß√µes</div>
              <div class="check-boxes">( ) SIM&nbsp;&nbsp;&nbsp;( ) N√ÉO</div>
            </div>
            <div class="check-item">
              <div>Estavam faltando itens do pedido dentro da caixa</div>
              <div class="check-boxes">( ) SIM&nbsp;&nbsp;&nbsp;( ) N√ÉO</div>
            </div>

            <div class="check-item">
              <div>Recebi a embalagem danificada</div>
              <div class="check-boxes">( ) SIM&nbsp;&nbsp;&nbsp;( ) N√ÉO</div>
            </div>
            <div></div>
          </div>

          <div style="text-align:center; margin-top:10px; font-size:11px;">
            (Campos de preenchimento obrigat√≥rio)
          </div>
        </div>

        <div class="lines-block">
          <div class="label">Relato destinat√°rio (Campo de preenchimento obrigat√≥rio):</div>
          <div class="line"></div><div class="line"></div><div class="line"></div>
        </div>

        <div class="lines-block">
          <div class="label">Observa√ß√µes Entregador (Campo de preenchimento obrigat√≥rio):</div>
          <div class="line"></div><div class="line"></div><div class="line"></div>
        </div>

        <div class="footer-row">
          <div class="footer-field">
            <strong>Local:</strong> <div class="footer-blank"></div>
          </div>
          <div class="footer-field">
            <strong>Data:</strong> <div class="footer-blank"></div>
          </div>
        </div>

        <div class="signature">
          <div class="sig-line">Nome/Assinatura do cliente</div>
          <div class="sig-line">Nome/Assinatura do entregador<br><strong><span id="doc-entregador-ass"></span></strong></div>
        </div>
      </div>

    </div>
  </div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const btnEtiqueta = document.getElementById('btnEtiqueta');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');

    const etiquetaImgDoc = document.getElementById('etiquetaImgDoc');
    const etiquetaPlaceholder = document.getElementById('etiquetaPlaceholder');

    const form = document.getElementById('form');
    const pagesContainer = document.getElementById('pagesContainer');

    const btnPDF = document.getElementById('btnPDF');
    const btnCopy = document.getElementById('btnCopy');
    const btnWA = document.getElementById('btnWA');

    const wa1 = document.getElementById('wa1');
    const wa2 = document.getElementById('wa2');
    const waMsg = document.getElementById('waMsg');

    let etiquetaDataUrl = "";

    function onlyDigits(v) {
      return (v || "").replace(/\D/g, "");
    }

    function formatDateBR(dateStr) {
      if (!dateStr) return "";
      // date (yyyy-mm-dd)
      const [y,m,d] = dateStr.split("-");
      if (!y || !m || !d) return "";
      return `${d}/${m}/${y}`;
    }

    function formatDateTimeBR(dtStr) {
      if (!dtStr) return "";
      // datetime-local (yyyy-mm-ddThh:mm)
      const parts = dtStr.split("T");
      if (parts.length !== 2) return "";
      const date = formatDateBR(parts[0]);
      const time = parts[1].slice(0,5);
      return `${date} ${time}`;
    }

    function buildWhatsAppMessage(data) {
      return (
`ACAREA√á√ÉO DE ENTREGA
AWB/CTE: ${data.cte}
Entregador: ${data.entregador}
Motivo da Solicita√ß√£o: ${data.motivo}
Data/Hora da Solicita√ß√£o: ${data.dataSolicitacao}
Prazo de Entrega da Solicita√ß√£o: ${data.dataLimite}`
      );
    }

    function updateWhatsButtons() {
      const hasMsg = (waMsg.value || "").trim().length > 0;
      const n1 = onlyDigits(wa1.value);
      const n2 = onlyDigits(wa2.value);
      const hasNumber = (n1.length >= 10) || (n2.length >= 10);

      if (hasMsg && hasNumber) {
        btnWA.classList.add("enabled");
        btnWA.disabled = false;
      } else {
        btnWA.classList.remove("enabled");
        btnWA.disabled = true;
      }
    }

    // bot√£o "Selecionar etiqueta" realmente abre o file picker
    btnEtiqueta.addEventListener('click', () => {
      fileInput.click();
    });

    // ao escolher a etiqueta
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;

      if (!file.type.startsWith("image/")) {
        alert("Selecione uma imagem (JPG/PNG).");
        fileInput.value = "";
        return;
      }

      const reader = new FileReader();
      reader.onload = (ev) => {
        etiquetaDataUrl = ev.target.result;

        // preview no formul√°rio
        previewImg.src = etiquetaDataUrl;
        imagePreview.style.display = 'block';

        // etiqueta no documento (imprime)
        etiquetaImgDoc.src = etiquetaDataUrl;
        etiquetaImgDoc.style.display = 'block';
        etiquetaPlaceholder.style.display = 'none';
      };
      reader.readAsDataURL(file);
    });

    btnCopy.addEventListener("click", async () => {
      const text = (waMsg.value || "").trim();
      if (!text) { alert("Gere o documento primeiro para criar a mensagem."); return; }

      try {
        await navigator.clipboard.writeText(text);
        alert("Mensagem copiada!");
      } catch (e) {
        // fallback simples
        waMsg.focus();
        waMsg.select();
        document.execCommand("copy");
        alert("Mensagem copiada!");
      }
    });

    btnWA.addEventListener("click", () => {
      if (!btnWA.classList.contains("enabled")) return;

      const n1 = onlyDigits(wa1.value);
      const n2 = onlyDigits(wa2.value);
      const number = (n1.length >= 10) ? n1 : n2;

      const text = encodeURIComponent((waMsg.value || "").trim());
      const url = `https://wa.me/${number}?text=${text}`;
      window.open(url, "_blank");
    });

    btnPDF.addEventListener("click", () => {
      // ‚ÄúBaixar PDF‚Äù = abre impress√£o, usu√°rio salva como PDF
      window.print();
    });

    wa1.addEventListener("input", updateWhatsButtons);
    wa2.addEventListener("input", updateWhatsButtons);

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const entregadorVal = (document.getElementById('entregador').value || '').trim().toUpperCase();
      const cteVal = (document.getElementById('cte').value || '').trim();
      const motivoVal = (document.getElementById('motivo').value || '').trim();

      const dataEntregaVal = formatDateBR(document.getElementById('dataEntrega').value);
      const dataSolicitacaoVal = formatDateTimeBR(document.getElementById('dataSolicitacao').value);
      const dataLimiteVal = formatDateBR(document.getElementById('dataLimite').value);

      // preenche p√°ginas
      document.getElementById('doc-entregador-p1').textContent = entregadorVal;
      document.getElementById('doc-cte-p1').textContent = cteVal;
      document.getElementById('doc-dataEntrega-p1').textContent = dataEntregaVal;
      document.getElementById('doc-dataSolicitacao-p1').textContent = dataSolicitacaoVal;
      document.getElementById('doc-dataLimite-p1').textContent = dataLimiteVal;
      document.getElementById('doc-motivo-p1').textContent = motivoVal;

      document.getElementById('doc-cte2').textContent = cteVal;
      document.getElementById('doc-entregador-ass').textContent = entregadorVal;

      // gera mensagem WhatsApp (novo formato)
      const data = {
        cte: cteVal,
        entregador: entregadorVal,
        motivo: motivoVal,
        dataSolicitacao: dataSolicitacaoVal,
        dataLimite: dataLimiteVal
      };
      waMsg.value = buildWhatsAppMessage(data);

      // mostra docs + habilita bot√µes
      pagesContainer.classList.add('visible');
      btnPDF.classList.add('visible');

      updateWhatsButtons();

      // rola pra ver o documento
      setTimeout(() => {
        pagesContainer.scrollIntoView({ behavior: 'smooth' });
      }, 80);
    });

    // ao limpar, reseta tudo que √© visual
    document.getElementById("btnClear").addEventListener("click", () => {
      etiquetaDataUrl = "";
      fileInput.value = "";
      imagePreview.style.display = "none";
      previewImg.src = "";
      etiquetaImgDoc.src = "";
      etiquetaImgDoc.style.display = "none";
      etiquetaPlaceholder.style.display = "block";

      waMsg.value = "";
      btnWA.classList.remove("enabled");
      btnWA.disabled = true;

      btnPDF.classList.remove("visible");
      pagesContainer.classList.remove("visible");
    });
  </script>
</body>
</html>

