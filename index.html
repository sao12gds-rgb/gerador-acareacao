<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gerador de Acarea√ß√£o - Azul Cargo</title>

<style>
  *{margin:0;padding:0;box-sizing:border-box}

  body{font-family:Arial,sans-serif;background:#f5f5f5;padding:20px}
  .container{max-width:900px;margin:auto}

  .form-container{
    background:#fff;padding:30px;border-radius:10px;
    box-shadow:0 2px 10px rgba(0,0,0,.1);
  }

  .logo-main{display:block;margin:0 auto 10px;max-width:240px;height:auto}
  h1{ text-align:center;color:#0066cc;margin:10px 0 20px;font-size:24px }

  .form-group{margin-bottom:16px}
  .form-row{display:grid;grid-template-columns:1fr 1fr;gap:18px}

  label{display:block;font-weight:700;font-size:14px;color:#222;margin-bottom:6px}
  input,select,textarea{
    width:100%;padding:12px;border:1px solid #d0d0d0;border-radius:8px;
    font-size:14px;font-family:Arial,sans-serif;background:#fff
  }
  textarea{min-height:90px;resize:vertical}

  .hint{font-size:12px;color:#555;margin-top:6px}

  .upload-box{
    margin-top:12px;padding:14px;border:2px dashed #0066cc;border-radius:10px;
    background:#e7f3ff
  }
  #fileInput{display:none}
  .btn-upload{
    display:inline-block;margin-top:10px;background:#0b5cad;color:#fff;
    padding:12px 18px;border-radius:10px;font-weight:700;cursor:pointer;
    user-select:none
  }

  .image-preview{margin-top:10px;display:none}
  .image-preview img{max-width:280px;border:1px solid #ddd;border-radius:8px}

  .actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:18px}
  button{
    padding:14px;font-size:16px;font-weight:800;border:0;border-radius:10px;cursor:pointer
  }
  .btn-generate{background:#0066cc;color:#fff}
  .btn-pdf{background:#28a745;color:#fff;display:none}
  .btn-pdf.visible{display:block}

  /* WhatsApp */
  .wa-area{margin-top:18px}
  .wa-msg{min-height:150px}
  .wa-actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}
  .btn-copy{background:#0b5cad;color:#fff}
  .btn-wa{background:#25D366;color:#053b1f}
  .btn-wa:disabled{opacity:.5;cursor:not-allowed}

  /* DOCUMENTO (2 p√°ginas) */
  .pages-container{display:none;margin-top:20px}
  .pages-container.visible{display:block}

  .doc-page{
    width:210mm; min-height:297mm; background:#fff;
    padding:12mm; border:1px solid #aaa;
  }

  .logo-header{ text-align:center; margin-bottom:6px }
  .logo-header img{ max-width:140px; height:auto } /* menor na impress√£o */

  .doc-title{
    text-align:center;font-weight:900;font-size:16px;
    border-bottom:1px solid #000;padding-bottom:6px;margin-bottom:10px
  }

  .top-info{
    display:grid;grid-template-columns:1fr 1fr;gap:8px;
    font-size:12px;margin:8px 0 10px
  }
  .top-info div{border-bottom:1px solid #ddd;padding-bottom:6px}

  .etiqueta-space{
    width:280px;height:350px;border:2px solid #000;margin:10px auto 10px;
    display:flex;align-items:center;justify-content:center;overflow:hidden;
    background:#fff
  }
  .etiqueta-space img{max-width:100%;max-height:100%}
  .etiqueta-placeholder{font-weight:700;color:#666}

  .important{
    margin-top:10px;border:1px solid #ddd;background:#fffacd;padding:10px;
    font-size:12px;line-height:1.35
  }
  .important h3{font-size:13px;margin-bottom:6px}
  .important ul{margin-left:16px}
  .important li{margin:3px 0}

  .box{
    border:2px solid #000;padding:10px;font-size:12px;line-height:1.35
  }

  /* Linhas longas para caneta (nome/rg/parentesco) */
  .fill-line{
    display:inline-block;border-bottom:1px solid #000;height:16px;
    vertical-align:baseline;margin:0 6px;
  }
  .w-name{width:72%}
  .w-doc{width:36%}
  .w-kin{width:44%}

  /* Quadro de perguntas (modelo da imagem) */
  .qa-box{
    border:1px solid #000;margin-top:10px;padding:10px;font-size:12px
  }
  .qa-grid{
    display:grid;grid-template-columns:1fr 1fr;gap:12px
  }
  .qa-item{min-height:44px}
  .qa-title{font-weight:700;margin-bottom:4px}
  .qa-opt{display:flex;gap:18px}
  .opt{display:flex;align-items:center;gap:6px}
  .circle{
    width:16px;height:16px;border:1px solid #000;border-radius:50%;
    display:inline-block
  }

  .mandatory-note{
    text-align:center;font-size:11px;margin-top:6px
  }

  .lines-block{margin-top:12px;font-size:12px}
  .lines-block .label{font-weight:700;margin-bottom:6px}
  .line{
    border-bottom:1px solid #000;height:18px;margin:6px 0
  }

  .footer{
    display:grid;grid-template-columns:1fr 1fr;gap:18px;margin-top:12px;font-size:12px
  }
  .footer .fline{
    border-bottom:1px solid #000;height:16px;display:inline-block;width:70%;
    vertical-align:baseline;margin-left:6px
  }
  .signs{
    margin-top:16px;font-size:12px
  }
  .sign-line{
    border-bottom:1px solid #000;height:18px;margin:20px 0 6px;width:70%
  }

  .page-break{page-break-before:always}

  /* IMPRESS√ÉO: garantir 2 p√°ginas e mostrar docs */
  @media print{
    body{background:#fff;padding:0;margin:0}
    .form-container{display:none!important}
    .pages-container{display:block!important}
    .doc-page{border:none;margin:0;page-break-after:auto;page-break-inside:avoid}
    .page-break{page-break-before:always}
  }
</style>
</head>

<body>
<div class="container">

  <!-- FORMUL√ÅRIO -->
  <div class="form-container">
    <img src="logo-azulcargo.png" class="logo-main" alt="Azul Cargo Express">

    <h1>Gerador de Acarea√ß√£o Azul Cargo</h1>

    <div class="form-row">
      <div class="form-group">
        <label for="entregador">Entregador *</label>
        <input id="entregador" placeholder="Ex: EVERTON FRANCISCO" required>
      </div>
      <div class="form-group">
        <label for="cte">CTE/CTR *</label>
        <input id="cte" placeholder="Ex: 29031903" required>
      </div>
    </div>

    <div class="form-group">
      <label for="motivo">Motivo da Acarea√ß√£o *</label>
      <select id="motivo" required>
        <option value="">Selecione...</option>
        <option value="CLIENTE DESCONHECE O RECEBIMENTO">CLIENTE DESCONHECE O RECEBIMENTO</option>
        <option value="ENDERE√áO N√ÉO LOCALIZADO">ENDERE√áO N√ÉO LOCALIZADO</option>
        <option value="CLIENTE RECUSOU">CLIENTE RECUSOU</option>
        <option value="HOR√ÅRIO COMERCIAL">HOR√ÅRIO COMERCIAL</option>
        <option value="OUTRO">OUTRO</option>
      </select>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="dataEntrega">Data da Entrega *</label>
        <input type="date" id="dataEntrega" required>
      </div>
      <div class="form-group">
        <label for="dataSolicitacao">Data da Solicita√ß√£o *</label>
        <input type="date" id="dataSolicitacao" required>
      </div>
    </div>

    <div class="form-group">
      <label for="dataLimite">Data Limite *</label>
      <input type="date" id="dataLimite" required>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="wa1">WhatsApp 1 (somente n√∫meros)</label>
        <input id="wa1" placeholder="Ex: 5511999999999" inputmode="numeric">
      </div>
      <div class="form-group">
        <label for="wa2">WhatsApp 2 (somente n√∫meros)</label>
        <input id="wa2" placeholder="Ex: 5511988888888" inputmode="numeric">
      </div>
    </div>

    <div class="upload-box">
      <label>Etiqueta (imagem) ‚Äî sai na P√°gina 1 e IMPRIME</label>
      <div class="hint">Selecione a imagem da etiqueta (JPG/PNG). PDF como etiqueta n√£o d√° para embutir direto (navegador).</div>
      <input type="file" id="fileInput" accept="image/*">
      <div class="btn-upload" onclick="document.getElementById('fileInput').click()">Selecionar etiqueta</div>

      <div class="image-preview" id="imagePreview">
        <img id="previewImg" alt="Pr√©via da etiqueta">
      </div>
    </div>

    <div class="wa-area">
      <div class="form-group">
        <label for="waMsg">Mensagem WhatsApp (gerada automaticamente)</label>
        <textarea id="waMsg" class="wa-msg" placeholder="Clique em ‚ÄúGerar Documento‚Äù para preencher automaticamente..." readonly></textarea>
      </div>

      <div class="wa-actions">
        <button type="button" class="btn-copy" onclick="copiarMensagem()">Copiar Mensagem</button>
        <button type="button" class="btn-wa" id="btnAbrirWA" onclick="abrirWhatsApp()" disabled>Abrir WhatsApp</button>
      </div>
      <div class="hint">Observa√ß√£o: o navegador **n√£o consegue anexar o PDF automaticamente no WhatsApp**. Ele abre a conversa com a mensagem pronta; voc√™ s√≥ clica no ‚Äúüìé‚Äù e anexa o PDF salvo.</div>
    </div>

    <div class="actions">
      <button class="btn-generate" type="button" onclick="gerarDocumento()">Gerar Documento</button>
      <button class="btn-pdf" id="btnPdf" type="button" onclick="baixarPdf()">‚úÖ Baixar PDF (abre impress√£o / salvar como PDF)</button>
    </div>
  </div>

  <!-- DOCUMENTOS (2 P√ÅGINAS PARA IMPRESS√ÉO/PDF) -->
  <div class="pages-container" id="pagesContainer">

    <!-- P√ÅGINA 1: ETIQUETA + DIRETRIZES -->
    <div class="doc-page" id="page1">
      <div class="logo-header">
        <img src="logo-azulcargo.png" alt="Azul Cargo Express">
      </div>

      <div class="doc-title">ACAREA√á√ÉO</div>

      <div style="text-align:center;font-weight:800;font-size:12px;margin-bottom:8px;">
        ENTREGADOR: <span id="p1_entregador"></span>
      </div>

      <div class="top-info">
        <div><strong>Data Entrega:</strong> <span id="p1_dataEntrega"></span></div>
        <div><strong>Data Solicita√ß√£o:</strong> <span id="p1_dataSolicitacao"></span></div>
        <div><strong>Data Limite:</strong> <span id="p1_dataLimite"></span></div>
        <div><strong>CTE:</strong> <span id="p1_cte"></span></div>
      </div>

      <div class="etiqueta-space">
        <img id="etiquetaImg" style="display:none" alt="Etiqueta">
        <div class="etiqueta-placeholder" id="etiquetaPlaceholder">ETIQUETA</div>
      </div>

      <div class="important">
        <h3>INFORMA√á√ïES IMPORTANTES:</h3>
        <ul>
          <li>Quando o motivo desta acarea√ß√£o for <strong>‚ÄúCLIENTE DESCONHECE O RECEBIMENTO‚Äù</strong>, somente o entregador que realizou a entrega poder√° realizar a acarea√ß√£o.</li>
          <li>Na condi√ß√£o de aus√™ncia de pessoas no local, <strong>OBRIGAT√ìRIA</strong> foto do local repassado no grupo de WhatsApp.</li>
          <li>No caso de acarea√ß√£o realizada onde o destinat√°rio estiver ausente, e ainda assim estiver algu√©m no local (no caso de portaria, por exemplo), <strong>AL√âM DA FOTO DO LOCAL</strong> repassada pelo grupo de WhatsApp, solicitar o preenchimento do formul√°rio, indicando no campo <strong>‚ÄúGrau de Parentesco = PORTARIA‚Äù</strong>.</li>
        </ul>
      </div>
    </div>

    <!-- P√ÅGINA 2: QUESTION√ÅRIO (MODELO) -->
    <div class="doc-page page-break" id="page2">
      <div class="logo-header">
        <img src="logo-azulcargo.png" alt="Azul Cargo Express">
      </div>

      <div class="doc-title">ACAREA√á√ÉO</div>

      <div class="top-info" style="margin-top:0">
        <div><strong>Entregador:</strong> <span id="p2_entregador"></span></div>
        <div><strong>CTE:</strong> <span id="p2_cte"></span></div>
        <div><strong>Motivo:</strong> <span id="p2_motivo"></span></div>
        <div><strong>Datas:</strong> <span id="p2_datas"></span></div>
      </div>

      <div class="box">
        <div style="text-align:center;font-weight:900;margin-bottom:8px;">ACAREA√á√ÉO</div>

        <div style="margin-bottom:8px;">
          Eu,<span class="fill-line w-name"></span>
          portador(a) do documento RG/CPF n¬∫<span class="fill-line w-doc"></span>,
          grau de parentesco com destinat√°rio<span class="fill-line w-kin"></span>,
          declaro informa√ß√µes referente ao CTE <strong><span id="p2_cte2"></span></strong>
          (Campos de preenchimento obrigat√≥rio):
        </div>

        <div class="qa-box">
          <div class="qa-grid">
            <div class="qa-item">
              <div class="qa-title">Recebi a carga mencionada</div>
              <div class="qa-opt">
                <div class="opt"><span class="circle"></span>SIM</div>
                <div class="opt"><span class="circle"></span>N√ÉO</div>
              </div>
            </div>

            <div class="qa-item">
              <div class="qa-title">Produtos internos estavam intactos</div>
              <div class="qa-opt">
                <div class="opt"><span class="circle"></span>SIM</div>
                <div class="opt"><span class="circle"></span>N√ÉO</div>
              </div>
            </div>

            <div class="qa-item">
              <div class="qa-title">Recebi a carga em perfeitas condi√ß√µes</div>
              <div class="qa-opt">
                <div class="opt"><span class="circle"></span>SIM</div>
                <div class="opt"><span class="circle"></span>N√ÉO</div>
              </div>
            </div>

            <div class="qa-item">
              <div class="qa-title">Estavam faltando itens do pedido dentro da caixa</div>
              <div class="qa-opt">
                <div class="opt"><span class="circle"></span>SIM</div>
                <div class="opt"><span class="circle"></span>N√ÉO</div>
              </div>
            </div>

            <div class="qa-item">
              <div class="qa-title">Recebi a embalagem danificada</div>
              <div class="qa-opt">
                <div class="opt"><span class="circle"></span>SIM</div>
                <div class="opt"><span class="circle"></span>N√ÉO</div>
              </div>
            </div>

            <div class="qa-item">
              <div class="qa-title">&nbsp;</div>
              <div class="qa-opt" style="opacity:0">.</div>
            </div>
          </div>

          <div class="mandatory-note">(Campos de preenchimento obrigat√≥rio)</div>
        </div>

        <div class="lines-block">
          <div class="label">Relato destinat√°rio (Campo de preenchimento obrigat√≥rio):</div>
          <div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div>
        </div>

        <div class="lines-block" style="margin-top:10px;">
          <div class="label">Observa√ß√µes Entregador (Campo de preenchimento obrigat√≥rio):</div>
          <div class="line"></div><div class="line"></div><div class="line"></div>
        </div>

        <div class="footer">
          <div>Local:<span class="fline"></span></div>
          <div>Data:<span class="fline" style="width:45%"></span> / <span class="fline" style="width:10%"></span> / <span class="fline" style="width:10%"></span></div>
        </div>

        <div class="signs">
          <div class="sign-line"></div>
          <div>Nome/Assinatura do cliente</div>

          <div class="sign-line" style="margin-top:18px;"></div>
          <div>Nome/Assinatura do entregador</div>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
  let etiquetaDataURL = "";

  function formatarDataISO(iso){
    if(!iso) return "";
    const d = new Date(iso + "T00:00:00");
    return d.toLocaleDateString("pt-BR");
  }

  function limparNumeroWhats(v){
    return (v||"").replace(/\D/g,'');
  }

  // Upload etiqueta (imagem) -> vira DataURL e imprime na p√°gina 1
  document.getElementById('fileInput').addEventListener('change', function(e){
    const file = e.target.files[0];
    if(!file) return;

    if(!file.type.startsWith("image/")){
      alert("Por favor, selecione uma IMAGEM (JPG/PNG).");
      e.target.value = "";
      return;
    }

    const reader = new FileReader();
    reader.onload = function(ev){
      etiquetaDataURL = ev.target.result;

      document.getElementById('previewImg').src = etiquetaDataURL;
      document.getElementById('imagePreview').style.display = 'block';

      document.getElementById('etiquetaImg').src = etiquetaDataURL;
      document.getElementById('etiquetaImg').style.display = 'block';
      document.getElementById('etiquetaPlaceholder').style.display = 'none';
    };
    reader.readAsDataURL(file);
  });

  function gerarMensagemWhats(cte, motivo, entregador, dEntrega, dSolic, dLim){
    return [
      "Ol√°! Tudo bem?",
      "",
      "Segue em anexo o documento de ACAREA√á√ÉO.",
      "",
      "‚Ä¢ CTE: " + (cte || ""),
      "‚Ä¢ Motivo: " + (motivo || ""),
      "‚Ä¢ Entregador: " + (entregador || ""),
      "‚Ä¢ Data Entrega: " + (dEntrega || ""),
      "‚Ä¢ Data Solicita√ß√£o: " + (dSolic || ""),
      "‚Ä¢ Data Limite: " + (dLim || ""),
      "",
      "Por gentileza, confirmar o recebimento e nos retornar ap√≥s o preenchimento."
    ].join("\n");
  }

  function gerarDocumento(){
    const entregador = (document.getElementById('entregador').value || "").trim().toUpperCase();
    const cte = (document.getElementById('cte').value || "").trim();
    const motivo = document.getElementById('motivo').value || "";

    const dataEntrega = formatarDataISO(document.getElementById('dataEntrega').value);
    const dataSolic = formatarDataISO(document.getElementById('dataSolicitacao').value);
    const dataLim = formatarDataISO(document.getElementById('dataLimite').value);

    if(!entregador || !cte || !motivo || !dataEntrega || !dataSolic || !dataLim){
      alert("Preencha todos os campos obrigat√≥rios (*).");
      return;
    }

    // P√°gina 1
    document.getElementById('p1_entregador').textContent = entregador;
    document.getElementById('p1_cte').textContent = cte;
    document.getElementById('p1_dataEntrega').textContent = dataEntrega;
    document.getElementById('p1_dataSolicitacao').textContent = dataSolic;
    document.getElementById('p1_dataLimite').textContent = dataLim;

    // P√°gina 2
    document.getElementById('p2_entregador').textContent = entregador;
    document.getElementById('p2_cte').textContent = cte;
    document.getElementById('p2_motivo').textContent = motivo;
    document.getElementById('p2_datas').textContent = `${dataEntrega} | ${dataSolic} | ${dataLim}`;
    document.getElementById('p2_cte2').textContent = cte;

    // Mensagem WhatsApp
    const msg = gerarMensagemWhats(cte, motivo, entregador, dataEntrega, dataSolic, dataLim);
    document.getElementById('waMsg').value = msg;

    // Habilitar bot√£o WhatsApp se tiver ao menos 1 n√∫mero
    const wa1 = limparNumeroWhats(document.getElementById('wa1').value);
    const wa2 = limparNumeroWhats(document.getElementById('wa2').value);
    document.getElementById('btnAbrirWA').disabled = !(wa1 || wa2);

    // Mostrar p√°ginas + bot√£o PDF
    document.getElementById('pagesContainer').classList.add('visible');
    document.getElementById('btnPdf
